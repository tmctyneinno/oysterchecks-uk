$(() => {


    $('#paymentMethod2').on('click', () => {
        $('#fundWalletSubmit').html('Show Instructions');
    });

    $('#paymentMethod1').on('click', () => {
        $('#fundWalletSubmit').html('Pay Securely');
    });


    $('#customAmount').on('keyup', () => {
        if ($('#customAmount').val() != "" && $("[name='paymentMethod']").is(':checked')) {
            $('#fundWalletSubmit').removeAttr('disabled');
        } else {
            $('#fundWalletSubmit').attr('disabled', 'disabled');
        }
    });

    $('#fundWalletForm').on('submit', (e) => {
        e.preventDefault();
        if ($('#customAmount').val() != "" && $('#paymentMethod2').is(':checked')) {
            let instructionsModal = $('#instructionsModalBody');
            $('#instructionsModalLabel').html('Fund Wallet With Bank Transfer');
            let endpoint = window.location.origin + "/user/fund/request";
            let nairaNG = Intl.NumberFormat("en-NG", {
                style: "currency",
                currency: "NGN",
            });
            try {
                fetch(endpoint, {
                    method: 'POST',
                    body: JSON.stringify({
                        customAmount: $('#fundWalletForm').find('#customAmount').val(),
                        paymentMethod: $('#fundWalletForm').find('#paymentMethod2').val(),
                        _token: $('#fundWalletForm').find('[name="_token"]').val()
                    }),
                    headers: {
                        "Content-Type": "application/json"
                    }
                })
                    .then((response) => {
                        return response.json();
                    })
                    .then((data) => {
                        console.log(data);
                        if (data.success == true && data.statusCode == 201) {
                            let elementString = `
                           <div class="row">
                                <div class="col-12 py-2 text-center">
                                   <i class="dripicons-information font-40"></i>
                                </div><!--end col-->
                                <div class="col-12 py-2 text-center">
                                   <h3 class="mb-2">Are you sure?</h3>
                                   <p class="">You are initiating a `+ nairaNG.format(data.data.amount) + ` fund request</p>
                                </div><!--end col-->
                                <div class="col-12 py- /2 border-bottom d-flex justify-content-between">
                                   <p>VAT Charge (7.5%)</p>
                                   <p class="fw-bold">`+ nairaNG.format(data.data.tax) + `</p>
                                </div><!--end col-->
                                <div class="col-12 py-2 d-flex justify-content-between">
                                   <p class="mt-3">Total amount Payable</p>
                                   <p class="fw-bold mt-3">`+ nairaNG.format(data.data.total_amount) + `</p>
                                </div><!--end col-->
                                <div class="col-12 px-2 py-2 rounded-3" style="background-color:rgba(137,151,189,0.06);">
                                    <p class="mb-0 font-12">Make a bank transfer of `+ nairaNG.format(data.data.total_amount) + ` to:</p>
                                    <p class="mb-0 font-12"><span class="fw-bold">Account Name:</span> The Morgans Consortium</p>
                                    <p class="mb-0 font-12"><span class="fw-bold">Bank:</span> Access Bank</p>  
                                    <p class="font-12"><span class="fw-bold">Account Number:</span> 000892392389</p>
                                    <p class="font-12">After transfer, please send this transaction reference(<span class="fw-bold">`+ data.data.reference + `</span>) and a proof of payment to <a class="text-primary" href="#">billings@oysterchecks.com</a></p>
                                </div>
                            </div><!--end row-->`;
                            instructionsModal.html(elementString);
                            $('#proceedModal').html('Ok, done');
                            $('#cancelModal').html('cancel');
                            $('#fundWallet').modal('hide');
                            $('#instructionsModal').modal('show');
                        } else {
                            console.log(data);
                            if (data.errors.customAmount) {
                                $('#fundWalletForm').find('#customAmount').parsley().addError('customError', { message: data.errors.customAmount });
                            }

                            if (data.errors.paymentMethod) {
                                $('#fundWalletForm').find('#paymentMethod1').parsley().addError('customError', { message: data.errors.paymentMethod });
                            }
                        }
                    })
                    .catch((error) => {
                        console.log('Error:', error);
                    });
            } catch (error) {
                console.log('Error:', error);
            }
        }

        if ($('#customAmount').val() != "" && $('#paymentMethod1').is(':checked')) {
            let instructionsModal = $('#instructionsModalBody');
            $('#instructionsModalLabel').html('Fund Wallet With Card');
            // let endpoint = window.location.origin + "/fund/wallet";
            let nairaNG = Intl.NumberFormat("en-NG", { style: "currency", currency: "NGN", minimumFractionDigits: 0, maximumFractionDigits: 2, });
            let customAmount = $('#fundWalletForm').find('#customAmount').val();
            let tax = (customAmount * 7.5) / 100;
            let totalAmount = parseInt(tax) + parseInt(customAmount);
            console.log(totalAmount);
            console.log(customAmount);
            console.log(tax);
            let paymentMethod = $('#fundWalletForm').find('#paymentMethod1').val();
            let token = $('#fundWalletForm').find('[name="_token"]').val();
            let elementString = `
                       <div class="row">
                            <div class="col-12 py-2 text-center">
                               <i class="dripicons-information font-40"></i>
                            </div><!--end col-->
                            <div class="col-12 py-2 text-center">
                               <h3 class="mb-2">Are you sure?</h3>
                               <p class="">You are initiating a `+ nairaNG.format(customAmount) + ` fund request</p>
                            </div><!--end col-->
                            <div class="col-12 py- /2 border-bottom d-flex justify-content-between">
                               <p>VAT Charge (7.5%)</p>
                               <p class="fw-bold">`+ nairaNG.format(tax) + `</p>
                            </div><!--end col-->
                            <div class="col-12 py-2 d-flex justify-content-between">
                               <p class="mt-3">Total amount Payable</p>
                               <p class="fw-bold mt-3">`+ nairaNG.format(totalAmount) + `</p>
                            </div><!--end col--> 
                        </div><!--end row-->`;
            instructionsModal.html(elementString);
            $('#proceedModal').html('Yes, proceed');
            $('#cancelModal').html('No, cancel');
            $('#fundWallet').modal('hide');
            $('#instructionsModal').modal('show');
        }
    });


    $('#cancelModal').on('click', () => {
        // e.preventDefault();
        $('#instructionsModal').modal('hide');
        $('#fundWallet').modal("show");
    });

    $('#proceedModal').on('click', () =>{
        if ($('#proceedModal').html() == 'Yes, proceed'){
            $('#instructionsModal').modal('hide');
            let form = document.getElementById('fundWalletForm');
                form.submit();

        }else{
            $('#instructionsModal').modal('hide');

        }
    });




});